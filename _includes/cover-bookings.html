{% assign test_ind = site.data.site.test-ind %}

{% if test_ind == true %}
    {% assign today_date = site.data.site.test-date %}
{% else %}
    {% assign today_date = 'now' | date: '%Y%m%d' %}
{% endif %}

{% assign limit = site.data.bookings-info.cover-period %}

<!-- {% assign end_date = today_date | plus: limit %} -->

{% assign row_found = false %}

{% for row in site.data.bookings %}
    {% if row_found == false %}
        {% if today_date <= row.NumDate %}
            {% assign booking_date = row.Date %}
            {% assign booking_desc = row.Description %}
            {% assign booking_venue = row.Venue %}
            {% assign booking_image = row.Image %}
            {% assign row_found = true %}
        {% endif %}
    {% endif %}
{% endfor %}

<div class="wrapper cover" style="background-image: linear-gradient(to bottom, rgb(200, 200, 200, .8), 55%, rgb(200, 200, 200, .2)), url('assets/images/{{ booking_image }}')">

    <div class="stack">
        <div>
            <h1>Next Bookings</h1>
        </div>
        {% if row_found == true %}
        <div class="alert alert--success alert--flx">
            <div class="Rtable">
            {% assign prev_date = "none" %}
            {% assign same-day = false %}
            {% assign count = 0 %}
            {% for row in site.data.bookings %}
                {% if today_date <= row.NumDate %}
                    {% if row.Date != prev_date %}
                        {% assign count = count | plus: 1 %}
                        {% if count > limit %}
                            {% break %}
                        {% endif %}
                        {% assign prev_date = row.Date %}
                        {% assign same-day = false %}
                    {% else %}
                        {% assign same-day = true %}
                    {% endif %}
                {% endif %}
                {% if same-day == true %}
                    <div class="Rtable-row Rtable-row--same-day">
                        <div class="Rtable-cell Rtable-cell--BkDate Rtable-cell--BkDate-same-day">

                {% else %}
                    {% if count == 1 %}
                        <div class="Rtable-row Rtable-row--same-day">
                    {% else %}
                        <div class="Rtable-row Rtable-row--new-day">
                    {% endif %}                    
                            <div class="Rtable-cell Rtable-cell--BkDate">
                    <!-- <div class="Rtable-row Rtable-row--new-day">
                        <div class="Rtable-cell Rtable-cell--BkDate"> -->

                {% endif %}
                            {{ row.Date }}
                        </div>
                        {% capture venue_desc %}
                        {{ row.Venue }} ({{ row.Description }})
                        {% endcapture %}
                        <div class="Rtable-cell Rtable-cell--BkVenueDesc">
                            {{ venue_desc }}
                        </div>
                        <div class="Rtable-cell Rtable-cell--BkVenue">
                            {{ row.Venue }}
                        </div>
                        <div class="Rtable-cell Rtable-cell--BkDesc">
                            {{ row.Description }}
                        </div>
                    </div>

            {% endfor %}
            </div>
        </div>
    
        {% else %}
    
        <div class="alert alert--success alert--flex">
            <div>
                <span class="span-center">
                    <span class="pull-left">
                        <i class="fas fa-info-circle"></i>
                        <p>Current Bookings Calendar completed, see you next season.</p>
                    </span>
                </span>
            </div>
        </div>
        
    
        {% endif %}
    
    </div>

</div>
